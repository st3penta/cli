
[valid policy URL:stdout - 1]
{
  "success": true,
  "filepaths": [
    {
      "filepath": "pipeline_definition.yaml",
      "violations": [],
      "warnings": [],
      "successes": null,
      "success": true,
      "success-count": 1
    }
  ],
  "policy": {
    "sources": [
      {
        "policy": [
          "git::https://${GITHOST}/git/happy-day-policy.git"
        ]
      }
    ]
  },
  "ec-version": "${EC_VERSION}",
  "effective-time": "${TIMESTAMP}"
}
---

[valid policy URL:stderr - 1]

---
[valid policy URL with text output:stdout - 1]
Success: true
Result: SUCCESS
Violations: 0, Warnings: 0, Successes: 1
Input File: pipeline_definition.yaml

Results:
[32mâœ“[0m [32m[Success] main.acceptor[0m
  FilePath: pipeline_definition.yaml


---

[valid policy URL with text output:stderr - 1]

---

[policy with multiple sources:stdout - 1]
{
  "success": false,
  "filepaths": [
    {
      "filepath": "input.yaml",
      "violations": [
        {
          "msg": "ham is not delicious",
          "metadata": {
            "code": "ham.delicious"
          }
        },
        {
          "msg": "spam is not true",
          "metadata": {
            "code": "spam.valid"
          }
        }
      ],
      "warnings": [],
      "successes": null,
      "success": false,
      "success-count": 0
    }
  ],
  "policy": {
    "sources": [
      {
        "policy": [
          "git::https://${GITHOST}/git/ham-policy"
        ]
      },
      {
        "policy": [
          "git::https://${GITHOST}/git/spam-policy"
        ]
      }
    ]
  },
  "ec-version": "${EC_VERSION}",
  "effective-time": "${TIMESTAMP}"
}
---

[policy with multiple sources:stderr - 1]
Error: success criteria not met

---

[multiple data source top level key clash:stdout - 1]

---

[multiple data source top level key clash:stderr - 1]
Error: error validating file input.json: evaluating policy: load: load documents: 1 error occurred during loading: ${TEMP}/ec-work-${RANDOM}/dat${RANDOM}/${RANDOM}/data.yaml: merge error

---

[policy URL with no rego files:stdout - 1]

---

[policy URL with no rego files:stderr - 1]
Error: error validating file pipeline_definition.yaml: evaluating policy: no rego files found in policy subdirectory

---

[multiple data source top level key map merging:stdout - 1]
ec-version: ${EC_VERSION}
effective-time: "${TIMESTAMP}"
filepaths:
- filepath: input.json
  success: true
  success-count: 0
  successes: null
  violations: []
  warnings:
  - msg: '{"george":"lead","john":"rhythm","paul":"bass","ringo":"drums"}'
policy:
  sources:
  - data:
    - file::acceptance/examples/data-merges/data-1
    - file::acceptance/examples/data-merges/data-2
    policy:
    - file::acceptance/examples/data-merges/policy
success: true

---

[multiple data source top level key map merging:stderr - 1]

---
